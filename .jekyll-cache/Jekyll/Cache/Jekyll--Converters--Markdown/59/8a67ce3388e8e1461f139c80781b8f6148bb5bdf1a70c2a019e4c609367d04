I"õ<blockquote>
  <p><strong>Sequence Alignment Map (SAM)</strong> is a text-based format originally for storing biological sequences aligned to a reference sequence developed by Heng Li and Bob Handsaker <em>et al</em>.</p>
</blockquote>

<h3 id="samæ–‡ä»¶">SAMæ–‡ä»¶</h3>

<p>Sequence Alignment Map(SAM)å­˜å‚¨readsåˆ°å‚è€ƒåŸºå› ç»„æ¯”å¯¹ä¿¡æ¯çš„æ–‡æœ¬æ ¼å¼ã€‚</p>

<p>SAMå†…å®¹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ³¨é‡Šä¿¡æ¯(head section)å’Œæ¯”å¯¹ç»“æœ(Alignment section)ã€‚</p>

<p><img src="https://www.samformat.info/images/sam_format_annotated_example.5108a0cd.jpg" alt="https://www.samformat.info/images/sam_format_annotated_example.5108a0cd.jpg" /></p>

<h4 id="æ³¨é‡Šä¿¡æ¯">æ³¨é‡Šä¿¡æ¯</h4>

<p>æ³¨é‡Šä¿¡æ¯ä»¥@å¼€å¤´</p>

<table>
  <thead>
    <tr>
      <th>ç¼©å†™</th>
      <th>å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@HD</td>
      <td>VN: æ ¼å¼ç‰ˆæœ¬; SO: æ¯”å¯¹æ’åˆ—é¡ºåº</td>
    </tr>
    <tr>
      <td>@SQ</td>
      <td>å‚è€ƒåºåˆ—ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>@RG</td>
      <td>Read groupä¿¡æ¯</td>
    </tr>
    <tr>
      <td>@PG</td>
      <td>Program, å‘½ä»¤è¯¦æƒ…</td>
    </tr>
    <tr>
      <td>@CO</td>
      <td>å…¶å®ƒè¡¥å……è¯´æ˜</td>
    </tr>
  </tbody>
</table>

<h4 id="æ¯”å¯¹ç»“æœ">æ¯”å¯¹ç»“æœ</h4>

<p>11ä¸ªå¿…é¡»å­—æ®µ + 1ä¸ªå¯é€‰å­—æ®µï¼Œå­—æ®µé—´TABåˆ†å‰²</p>

<table>
  <thead>
    <tr>
      <th>å­—æ®µ</th>
      <th>å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>QNAME</td>
      <td>FASTQä¸­çš„READ ID</td>
    </tr>
    <tr>
      <td>FLAG</td>
      <td>ä½æ ‡è¯†ç¬¦</td>
    </tr>
    <tr>
      <td>RNAME</td>
      <td>å‚è€ƒåºåˆ—åç§°</td>
    </tr>
    <tr>
      <td>POS</td>
      <td>1-basedæ¯”å¯¹ä½ç½®</td>
    </tr>
    <tr>
      <td>MAPQ</td>
      <td>æ¯”å¯¹è´¨é‡</td>
    </tr>
    <tr>
      <td>CIGAR</td>
      <td>ç®€è¦æ¯”å¯¹ä¿¡æ¯è¡¨è¾¾å¼(Compact Idiosyncratic Gapped Alignment Report)</td>
    </tr>
    <tr>
      <td>RNEXT</td>
      <td>é…å¯¹ç‰‡æ®µ(mate)æ¯”å¯¹ä¸Šçš„å‚è€ƒåºåˆ—çš„ç¼–å·ï¼Œæ²¡æœ‰å¦å¤–çš„ç‰‡æ®µï¼Œè¿™é‡Œæ˜¯â€™*â€˜ï¼ŒåŒä¸€ä¸ªç‰‡æ®µï¼Œç”¨â€™=â€™</td>
    </tr>
    <tr>
      <td>PNEXT</td>
      <td>é…å¯¹ç‰‡æ®µ(mate)æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Šçš„ç¬¬ä¸€ä¸ªç¢±åŸºä½ç½®ï¼Œè‹¥æ— mate,åˆ™ä¸º0ï¼›</td>
    </tr>
    <tr>
      <td>TLEN</td>
      <td>Templateçš„é•¿åº¦ï¼Œæœ€å·¦è¾¹å¾—ä¸ºæ­£ï¼Œæœ€å³è¾¹çš„ä¸ºè´Ÿï¼Œä¸­é—´çš„ä¸ç”¨å®šä¹‰æ­£è´Ÿï¼Œä¸åˆ†åŒºæ®µï¼ˆsingle-segment)çš„æ¯”å¯¹ä¸Šï¼Œæˆ–è€…ä¸å¯ç”¨æ—¶ï¼Œæ­¤å¤„ä¸º0</td>
    </tr>
    <tr>
      <td>SEQ</td>
      <td>readsçš„åºåˆ—ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>QUAL</td>
      <td>readsçš„è´¨é‡ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>Optional fields</td>
      <td>å¯é€‰å­—æ®µ</td>
    </tr>
  </tbody>
</table>

<h5 id="flagä½æ ‡è¯†ç¬¦">FLAGä½æ ‡è¯†ç¬¦</h5>

<pre><code class="language-C">/*! @abstract the read is paired in sequencing, no matter whether it is mapped in a pair */
#define BAM_FPAIRED        1
/*! @abstract the read is mapped in a proper pair */
#define BAM_FPROPER_PAIR   2
/*! @abstract the read itself is unmapped; conflictive with BAM_FPROPER_PAIR */
#define BAM_FUNMAP         4
/*! @abstract the mate is unmapped */
#define BAM_FMUNMAP        8
/*! @abstract the read is mapped to the reverse strand */
#define BAM_FREVERSE      16
/*! @abstract the mate is mapped to the reverse strand */
#define BAM_FMREVERSE     32
/*! @abstract this is read1 */
#define BAM_FREAD1        64
/*! @abstract this is read2 */
#define BAM_FREAD2       128
/*! @abstract not primary alignment */
#define BAM_FSECONDARY   256
/*! @abstract QC failure */
#define BAM_FQCFAIL      512
/*! @abstract optical or PCR duplicate */
#define BAM_FDUP        1024
/*! @abstract supplementary alignment */
#define BAM_FSUPPLEMENTARY 2048

</code></pre>

<table>
  <thead>
    <tr>
      <th>ä½æ ‡è¯†ç¬¦</th>
      <th>å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>PEåŒç«¯æµ‹åº</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Read mapped in proper pair, Readå’ŒMATEéƒ½æ¯”å¯¹ä¸Šï¼Œä¸”é—´è·åˆç†</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Readæ²¡æœ‰æ¯”å¯¹ä¸Š</td>
    </tr>
    <tr>
      <td>8</td>
      <td>MATEæ²¡æœ‰æ¯”å¯¹ä¸Š</td>
    </tr>
    <tr>
      <td>16</td>
      <td>READæ¯”å¯¹åˆ°åä¹‰é“¾</td>
    </tr>
    <tr>
      <td>32</td>
      <td>MATEæ¯”å¯¹åˆ°åä¹‰é“¾</td>
    </tr>
    <tr>
      <td>64</td>
      <td>è¿™æ¡readæ˜¯read1</td>
    </tr>
    <tr>
      <td>128</td>
      <td>è¿™æ¡readæ˜¯read2</td>
    </tr>
    <tr>
      <td>256</td>
      <td>ä¸æ˜¯ä¸»è¦æ¯”å¯¹(primary alignment)</td>
    </tr>
    <tr>
      <td>512</td>
      <td>QCå¤±è´¥</td>
    </tr>
    <tr>
      <td>1024</td>
      <td>PCRé‡å¤</td>
    </tr>
    <tr>
      <td>2048</td>
      <td>supplementary alignment</td>
    </tr>
  </tbody>
</table>

<h5 id="cigarç®€è¦æ¯”å¯¹ä¿¡æ¯è¡¨è¾¾å¼">CIGARç®€è¦æ¯”å¯¹ä¿¡æ¯è¡¨è¾¾å¼</h5>

<p><img src="https://pic3.zhimg.com/80/v2-e765bb1b5321f7cdc50a57a28b6fb522_1440w.jpg" alt="https://pic3.zhimg.com/80/v2-e765bb1b5321f7cdc50a57a28b6fb522_1440w.jpg" /></p>

<p><img src="http://linux-bio.com/wp-content/uploads/2015/06/sam_format_manual_pdf_capture2.png" alt="http://linux-bio.com/wp-content/uploads/2015/06/sam_format_manual_pdf_capture2.png" /></p>

<h3 id="bamæ–‡ä»¶">BAMæ–‡ä»¶</h3>

<p>BAMæ–‡ä»¶æ˜¯SAMæ–‡ä»¶çš„å‹ç¼©äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œå‹ç¼©ç‡åœ¨5å·¦å³ã€‚</p>

<h4 id="æŸ¥çœ‹bamæ–‡ä»¶">æŸ¥çœ‹BAMæ–‡ä»¶</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>samtools view sample.bam
</code></pre></div></div>

<h4 id="æ£€æŸ¥bamæ–‡ä»¶å®Œæ•´æ€§">æ£€æŸ¥BAMæ–‡ä»¶å®Œæ•´æ€§</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>samtools quickcheck sample.bam

<span class="c">## or </span>

<span class="nb">tail</span> <span class="nt">-c</span> 28 sample.bam | xxd <span class="nt">-p</span>
<span class="c">## Output: 1f8b08040000000000ff0600424302001b0003000000000000000000</span>

</code></pre></div></div>

<h3 id="reference">Reference</h3>

<ol>
  <li><a href="https://www.samformat.info/sam-format-flag">https://www.samformat.info/sam-format-flag</a></li>
  <li><a href="https://en.wikipedia.org/wiki/SAM_(file_format)">https://en.wikipedia.org/wiki/SAM_(file_format)</a></li>
  <li><a href="https://vip.biotrainee.com/d/162-sam">https://vip.biotrainee.com/d/162-sam</a></li>
</ol>
:ET